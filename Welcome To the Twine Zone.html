

  <!-- SUBMIT GAME FORM -->
  <form id="submitForm">
    <label>ğŸ“ Game Title</label>
    <input type="text" id="title" required placeholder="Your gameâ€™s awesome title">

    <label>ğŸ‘¤ Author</label>
    <input type="text" id="author" placeholder="Your name or handle (optional)">

    <label>ğŸ–‹ï¸ Description</label>
    <textarea id="description" placeholder="Short description of your game"></textarea>

    <label>ğŸ·ï¸ Tags (comma separated)</label>
    <input type="text" id="tags" placeholder="e.g. horror, puzzle, short">

    <label>ğŸ“‚ Twine .html File</label>
    <input type="file" id="file" accept=".html,.htm" required>

    <label>ğŸ–¼ï¸ Thumbnail (optional)</label>
    <input type="file" id="thumbnail" accept="image/*">

    <button type="submit">Submit My Game!</button>
  </form>

  <input type="text" id="searchBox" placeholder="ğŸ” Search by title or tag...">
  <div class="counter" id="gameCounter"></div>

  <h2>ğŸ•¹ï¸ Arcade Shelf</h2>
  <div id="gameList"></div>
</div>

<script>
// ================= DATABASE =================
let db;
let currentUser = null;
const request = indexedDB.open("TwineZoneDB", 6);
request.onerror = () => console.error("Database failed to open");
request.onsuccess = (e) => { db = e.target.result; loadGames(); };
request.onupgradeneeded = (e) => {
  db = e.target.result;
  if (!db.objectStoreNames.contains("games")) db.createObjectStore("games", { keyPath: "id", autoIncrement:true });
  if (!db.objectStoreNames.contains("users")) db.createObjectStore("users", { keyPath: "username" });
};

// ================= ACCOUNT =================
function hashPassword(str) { return btoa(str); }
const signupBtn = document.getElementById("signupBtn");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const welcomeMsg = document.getElementById("welcomeMsg");

signupBtn.addEventListener("click", () => {
  const username = document.getElementById("username").value.trim();
  const password = hashPassword(document.getElementById("password").value.trim());
  if (!username || !password) return alert("Enter username and password");
  const tx = db.transaction(["users"], "readwrite");
  const store = tx.objectStore("users");
  store.get(username).onsuccess = e => {
    if (e.target.result) return alert("Username taken!");
    store.add({ username, password });
    alert("Account created! You can now log in.");
  };
});

loginBtn.addEventListener("click", () => {
  const username = document.getElementById("username").value.trim();
  const password = hashPassword(document.getElementById("password").value.trim());
  if (!username || !password) return;
  const tx = db.transaction(["users"], "readonly");
  const store = tx.objectStore("users");
  store.get(username).onsuccess = e => {
    const user = e.target.result;
    if (!user || user.password !== password) return alert("Invalid login!");
    currentUser = username;
    welcomeMsg.textContent = "Welcome, " + currentUser;
    logoutBtn.style.display = "inline";
  };
});

logoutBtn.addEventListener("click", () => {
  currentUser = null;
  welcomeMsg.textContent = "";
  logoutBtn.style.display = "none";
});

// ================= GAME LOGIC =================
const form = document.getElementById("submitForm");
const gameList = document.getElementById("gameList");
const searchBox = document.getElementById("searchBox");
const gameCounter = document.getElementById("gameCounter");

function saveGame(game) { const tx = db.transaction(["games"], "readwrite"); tx.objectStore("games").add(game); }
function loadGames() {
  gameList.innerHTML = "";
  const tx = db.transaction(["games"], "readonly");
  const store = tx.objectStore("games");
  const request = store.openCursor(null,"prev");
  const allGames = [];
  request.onsuccess = e => {
    const cursor = e.target.result;
    if(cursor){ allGames.push(cursor.value); cursor.continue(); }
    else{ window.games = allGames; displayGames(allGames); }
  };
}
function displayGames(arr) { gameList.innerHTML=""; arr.forEach(createGameCard); gameCounter.textContent=`Total Games: ${arr.length}`; }
function createGameCard(game){
  const div = document.createElement("div"); div.className="game-card";
  div.innerHTML=`<img src="${game.thumbnail||'https://via.placeholder.com/180x140?text=No+Thumbnail'}" alt="Thumbnail">
  <div class="game-info">
    <strong>${game.title}</strong>
    <p>${game.description}</p>
    <div class="tags">${(game.tags||[]).map(t=>`<span>${t}</span>`).join("")}</div>
    <div class="game-links">
      <a href="${game.url}" target="_blank">ğŸ® Play</a> |
      <a href="${game.url}" download>ğŸ’¾ Download</a>
    </div>
  </div>`;
  if(game.owner && currentUser===game.owner){
    const delBtn=document.createElement("button"); delBtn.textContent="ğŸ—‘ï¸ Delete";
    delBtn.onclick=()=>{ const tx=db.transaction(["games"],"readwrite"); tx.objectStore("games").delete(game.id).onsuccess=()=>loadGames(); };
    div.querySelector(".game-links").appendChild(delBtn);
  }
  gameList.appendChild(div);
}

// CONFETTI EFFECT
function spawnConfetti(){
  for(let i=0;i<50;i++){
    const c=document.createElement("div");
    c.className="confetti"; c.style.left=Math.random()*100+"vw";
    c.style.backgroundColor=`hsl(${Math.random()*360},100%,50%)`;
    c.style.width=c.style.height=(5+Math.random()*5)+"px";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),2000);
  }
}

// SUBMIT FORM
form.addEventListener("submit", async e=>{
  e.preventDefault();
  const title=document.getElementById("title").value.trim();
  const author=document.getElementById("author").value.trim()||"Anonymous";
  const description=document.getElementById("description").value.trim();
  const tags=document.getElementById("tags").value.split(",").map(t=>t.trim()).filter(Boolean);
  const file=document.getElementById("file").files[0];
  const thumbFile=document.getElementById("thumbnail").files[0];
  if(!file){ alert("Please select a Twine file."); return; }
  if(!file.name.toLowerCase().endsWith(".html")&&!file.name.toLowerCase().endsWith(".htm")){ alert("Only .html Twine files allowed."); return; }
  const fileURL=URL.createObjectURL(file);
  let thumbnailURL=""; if(thumbFile) thumbnailURL=URL.createObjectURL(thumbFile);
  const game={ title, author, description, tags, url:fileURL, thumbnail:thumbnailURL, owner:currentUser };
  saveGame(game); window.games.unshift(game); displayGames(window.games); form.reset(); spawnConfetti();
});

// SEARCH
searchBox.addEventListener("input",()=>{ const term=searchBox.value.toLowerCase(); const filtered=window.games.filter(g=> g.title.toLowerCase().includes(term)||(g.tags||[]).some(tag=>tag.toLowerCase().includes(term))); displayGames(filtered); });

</script>
</body>
</html>
